# ComfyUI Run Button Assistant

本项目旨在为 ComfyUI 提供一个便捷的桌面级控制入口。它由两个相互配合的部分组成：作为服务端的 **ComfyUI 自定义节点** 和作为客户端的 **桌面悬浮按钮程序**。

## 1. ComfyUI 自定义节点 (Server Side)

这部分代码运行在 ComfyUI 后台，负责与 ComfyUI 系统进行集成。

*   **核心文件**:
    *   `__init__.py`: 节点的入口文件，注册节点逻辑。
    *   `js/run_listener.js`: 前端监听脚本，用于捕获 ComfyUI 的状态变化。
*   **功能**:
    *   作为标准的 Custom Node 存在，随 ComfyUI 启动而加载。
    *   提供 API 接口或状态钩子，确保外部程序能准确获取生成进度和状态。
*   **安装**:
    *   将整个 `run_button` 文件夹放置在 `ComfyUI/custom_nodes/` 目录下即可。

## 2. 桌面悬浮按钮 (Client Side)

这是一个独立的桌面应用程序（基于 Python Tkinter），作为“遥控器”使用。它可以运行在运行 ComfyUI 的本机上，也可以运行在同一局域网的其他电脑上。

*   **核心文件**:
    *   `ComfyRunButton.exe`: **推荐** 独立的可执行程序，无需配置 Python 环境即可直接运行。
    *   `float_run.py`: 源代码（Python 脚本）。
    *   `config.json`: 配置文件（存储服务器 IP、快捷键设置等）。
*   **功能**:
    *   **远程控制**: 通过 API 控制 ComfyUI 的 Queue Prompt 和 Interrupt。
    *   **实时状态**: 拥有进度条显示，实时反馈 ComfyUI 的连接状态（Online/Offline）、生成进度和队列剩余数。
    *   **智能连接**:
        *   **心跳检测**: 自动检测与服务器的连接。如果连接断开，按钮会自动变灰并显示 "OFFLINE"，防止误操作。
        *   **动态配置**: 首次运行或通过右键菜单可配置 ComfyUI 服务器地址（支持 `127.0.0.1:8188` 或局域网 IP 如 `192.168.1.x:8188`）。
    *   **快捷键系统**:
        *   支持全局快捷键（默认 `Ctrl+Enter` 运行，`F9` 隐藏/显示）。
        *   内置冲突检测机制，如果快捷键被占用会弹窗提示修改。

## 使用说明

1. **启动 ComfyUI**: 确保 ComfyUI 服务器已正常启动。
2. **启动悬浮按钮**:
    *   **方式一 (推荐)**: 直接双击运行 `ComfyRunButton.exe`。
    *   **方式二 (脚本)**: 双击运行 `run_float_button.bat` (适合需要修改源码调试的场景)。
3. **连接配置**:
    *   首次运行时，程序会询问 ComfyUI 的 IP 地址。
    *   本机使用默认 `127.0.0.1:8188` 即可。
    *   如需修改，可在按钮上 **点击右键 -> Settings (IP)** 进行重新配置。
4. **操作指南**:
    *   **左键点击**: 开始生成 (Queue) / 中断生成 (Interrupt) / 离线时尝试重连。
    *   **右键点击**: 打开功能菜单（切换 Mini 模式、设置 IP）。
    *   **拖拽**: 按住按钮任意位置即可拖动改变位置。
